# File generated by gflows, do not modify
# Source: .gflows/workflows/helm-chart
name: Release Helm Chart
"on":
  repository_dispatch:
    types:
    - helm_release
jobs:
  release_helmchart:
    if: github.ref_type == 'tag'
    name: release-helmchart
    runs-on: ubuntu-latest
    container: dtzar/helm-kubectl:3.10
    env:
      CHART_NAMES: chart helm base
      GCLOUD_SERVICE_ACCOUNT_KEY: ${{ secrets.HELM_CHART_SA_KEY }}
    steps:
    - uses: actions/checkout@v2
    - name: Package & Upload Helm Chart
      working-directory: ./$CHART_NAMES
      run: |-
        helm lint .
        echo ${{ secrets.GITHUB_TOKEN }} | helm registry login ghcr.io -u $ --password-stdin
        helm package . --version ${{ github.ref_name }} --app-version ${{ github.ref_name }}
        helm push .*-${{ github.ref_name }}.tgz oci://ghcr.io/covergo/charts
